#!/usr/bin/env bash

# Define the correct password
correct_password="DRAJ"

# Prompt the user for the password
echo -n "Enter password: "
read -s entered_password
echo

# Verify the password
if [[ "$entered_password" != "$correct_password" ]]; then
    echo "Incorrect password. Exiting..."
    exit 1
fi

# Source the banner script
source etc/banner

# Display banner
echo -e "executing: ${LIGHTGREEN} PUBG-PASTER"
echo "-----------------------"

# Check if the output directory exists, if not, create it
if [[ -d "output" ]]; then
    echo "Output directory exists."
else
    echo "Creating output directory..."
    mkdir output
fi

# Function to unpack .pak files
unpacking () {
  qemu-i386 $PREFIX/share/quickbms/quickbms -Q etc/tools.bms "$opt" output
}

# Function to repack .pak files
repacking () {
  qemu-i386 $PREFIX/share/quickbms/quickbms -w -r -r etc/tools.bms "$opt" output
}

# Function to prompt user to select a file to unpack
function unpack {
    prompt="Please select a file to unpack:"
    options=( $(find *.pak) )

    PS3="$prompt "
    select opt in "${options[@]}" "Quit"; do 
        if (( REPLY == 1 + ${#options[@]} )); then
            exit
        elif (( REPLY > 0 && REPLY <= ${#options[@]} )); then
            echo "You picked $opt which is file $REPLY"
            unpacking
            break
        else
            echo "Invalid option. Try another one."
        fi
    done
}

# Function to prompt user to select a file to repack
function repack {
    prompt="Please select a file to repack:"
    options=( $(find *.pak) )

    PS3="$prompt "
    select opt in "${options[@]}" "Quit"; do 
        if (( REPLY == 1 + ${#options[@]} )); then
            exit
        elif (( REPLY > 0 && REPLY <= ${#options[@]} )); then
            echo "You picked $opt which is file $REPLY"
            repacking
            break
        else
            echo "Invalid option. Try another one."
        fi
    done
}

# Main menu
PS3='Please enter your choice: '
options=("Unpack" "Repack" "Quit")
select opt in "${options[@]}"; do
    case $opt in
        "Unpack")
            unpack
            break
            ;;
        "Repack")
            repack
            ;;
        "Quit")
            break
            ;;
        *) echo "Invalid option $REPLY";;
    esac
done
