#!/usr/bin/env bash

# Define the password
PASSWORD="your_password_here"

# Prompt for the password
echo -n "Enter password: "
read -s input_password
echo

# Verify the password
if [[ "$input_password" != "$PASSWORD" ]]; then
    echo "Incorrect password. Exiting."
    exit 1
fi

source etc/banner
# Banner Add
echo -e "executing: ${LIGHTGREEN}ThePAK${NOCOLOR}"
echo "-----------------------"

if [[ ! -d "output" ]]; then
    mkdir output
fi

unpacking () {
  if qemu-i386 $PREFIX/share/quickbms/quickbms -Q etc/tools.bms "$opt" output; then
    echo "Unpacking completed successfully."
  else
    echo "Error during unpacking."
  fi
}

repacking () {
  if qemu-i386 $PREFIX/share/quickbms/quickbms -w -r -r etc/tools.bms "$opt" output; then
    echo "Repacking completed successfully."
  else
    echo "Error during repacking."
  fi
}

function unpack {
  prompt="Please select a file to unpack:"
  options=( $(find *.pak) )

  PS3="$prompt "
  select opt in "${options[@]}" "Quit"; do 
    if (( REPLY == 1 + ${#options[@]} )); then
        exit
    elif (( REPLY > 0 && REPLY <= ${#options[@]} )); then
        echo "You picked $opt which is file $REPLY"
        unpacking
        break
    else
        echo "Invalid option. Try another one."
    fi
  done
}

function repack {
  prompt="Please select a file to repack:"
  options=( $(find *.pak) )

  PS3="$prompt "
  select opt in "${options[@]}" "Quit"; do 
    if (( REPLY == 1 + ${#options[@]} )); then
        exit
    elif (( REPLY > 0 && REPLY <= ${#options[@]} )); then
        echo "You picked $opt which is file $REPLY"
        repacking
        break
    else
        echo "Invalid option. Try another one."
    fi
  done
}

PS3='Please enter your choice: '
options=("Unpack" "Repack" "Quit")
select opt in "${options[@]}"; do
    case $opt in
        "Unpack")
            unpack
            ;;
        "Repack")
            repack
            ;;
        "Quit")
            break
            ;;
        *) echo "Invalid option $REPLY";;
    esac
done
